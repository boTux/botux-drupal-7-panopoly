botux-drupal-7-panopoly
=======================

Git version of Drupal & Panopoly.

For upgrade Drupal Core and/or Panopoly with git and version control.

How to use 
----

On your dev git (branch master) : 

`git pull -Xtheirs https://github.com/boTux/botux-drupal-7-panopoly.git master`

And run `update.php` script on your site.

Generate the repository - Beware it's dirty !
----

Build Drupal Panopoly with `drush make` and `git`.


```
mkdir -p panopoly/build
cd panopoly/build
git clone --recursive --branch 7.x-1.x http://git.drupal.org/project/panopoly.git profiles/panopoly
```

We need to edit the `Drupal` section of the make file `build-panopoly.make` to install drupal core via git, so change it to :


```
$ vim profiles/panopoly/build-panopoly.make

; EDIT :
; Drupal
projects[drupal][type] = core
projects[drupal][download][type] = git
projects[drupal][download][branch] = 7.x
projects[drupal][download][revision] = 6642fbc 
; Adapt the revision with commit id : https://drupal.org/node/3060/commits

```
And we make :



```
drush make --prepare-install --no-gitinfofile --contrib-destination=profiles/panopoly profiles/panopoly/build-panopoly.make --working-copy

```
It might take some times... & now, we have now a repo with drupal core and panopoly

Move the panopoly generated by drush make in a safe place



```
cp -R profiles/panopoly ../panopoly-built
rm -Rdf profiles/panopoly
```

We now need the panopoly repo with commit history :


```
cd ..
git clone --recursive --branch 7.x-1.x http://git.drupal.org/project/panopoly.git panopoly-git
cd panopoly-git
wget https://gist.githubusercontent.com/boTux/11143877/raw/92cf1ab546fa86bf485b3992494dad59d157734d/git-rewrite-panopoly.sh
chmod +x git-rewrite-panopoly.sh
./git-rewrite-panopoly.sh
```
In the script enter `profiles/panopoly` when asked.


```
rm git-rewrite-panopoly.sh
git branch -m master
cd ../build
git remote add panopoly ../panopoly-git
git fetch panopoly
git merge -s ours --no-commit panopoly/master
cp -R ../panopoly-built profiles/panopoly
rm -Rdf  profiles/panopoly/.git profiles/panopoly/.gitignore
git add -A profiles/panopoly
git commit -na
git branch -d 8.x
git checkout -b master

```

`vim .git/config` to edit the 'origin' source to 'drupal'.

And we add the origin : 


```
git remote add origin https://github.com/boTux/botux-drupal-7-panopoly.git
git push -u origin master
```


Todo
----

Fix the modules with .git

```
	modifié:         profiles/panopoly/modules/contrib/apps (contenu modifié, contenu non suivi)
	modifié:         profiles/panopoly/modules/contrib/fape (contenu modifié, contenu non suivi)
	modifié:         profiles/panopoly/modules/contrib/navbar (contenu modifié, contenu non suivi)
```
